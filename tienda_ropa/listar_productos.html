<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Productos Registrados</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; }
    .container { max-width: 1000px; margin: 0 auto; background: white; padding: 25px; border: 1px solid #ddd; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #f5f5f5; }
    .btn { padding: 6px 10px; margin: 2px; border: none; border-radius: 4px; cursor: pointer; color: white; text-decoration: none; display: inline-block; }
    .btn-edit { background: #17a2b8; }
    .btn-delete { background: #dc3545; }
    .vacio { text-align: center; color: #777; padding: 20px; }
    .back { color: #0056b3; text-decoration: none; }
  </style>
</head>
<body>
  <!--
    Muestra todos los productos registrados.
    Incluye botones para EDITAR y ELIMINAR → cumple con CRUD completo.
    Requisito explícito del PDF: "Crear, leer, actualizar y eliminar productos".
  -->
  <div class="container">
    <h1>Productos Registrados</h1>
    <div id="mensaje"></div>
    <table>
      <thead>
        <tr><th>ID</th><th>Nombre</th><th>Precio</th><th>Categoría</th><th>Acciones</th></tr>
      </thead>
      <tbody id="cuerpo"></tbody>
    </table>
    <a href="menu_usuario.php" class="back">← Regresar al menú</a>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const res = await fetch('http://localhost/tienda_ropa/api/index.php?path=productos');
        const productos = await res.json();
        const tbody = document.getElementById('cuerpo');
        if (productos.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" class="vacio">No hay productos</td></tr>';
          return;
        }
        tbody.innerHTML = productos.map(p => `
          <tr>
            <td>${p.id}</td>
            <td>${p.nombre}</td>
            <td>$${parseFloat(p.precio).toFixed(2)}</td>
            <td>${p.categoria || '-'}</td>
            <td>
              <a href="editar_producto.html?id=${p.id}" class="btn btn-edit">Editar</a>
              <button onclick="eliminar(${p.id})" class="btn btn-delete">Eliminar</button>
            </td>
          </tr>
        `).join('');
      } catch (e) {
        document.getElementById('cuerpo').innerHTML = 
          '<tr><td colspan="5" class="vacio">Error de conexión</td></tr>';
      }
    });

    async function eliminar(id) {
      if (!confirm('¿Eliminar este producto?')) return;
      try {
        const res = await fetch(`http://localhost/tienda_ropa/api/index.php?path=productos/${id}`, {
          method: 'DELETE'
        });
        if (res.ok) {
          alert('Producto eliminado');
          location.reload();
        } else {
          const data = await res.json();
          alert('Error: ' + (data.error || 'No se pudo eliminar'));
        }
      } catch (e) {
        alert('Error de red');
      }
    }
  </script>
</body>
</html>